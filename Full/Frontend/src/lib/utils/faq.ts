// ============================================
// ðŸ“„ src/lib/utils/faq.ts
// ============================================
// FAQ ê´€ë ¨ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
// ============================================

import { FAQ } from '@/types/faq.types';

// Backend API ì‘ë‹µ íƒ€ìž…
interface FAQResponse {
  faq_id: string;
  question: string;
  answer: string;
  category?: string | null;
  tags?: string | null;
  product_id?: string | null;
  product_name?: string | null;
  status: string;
  is_auto_generated: boolean;
  source: string;
  view_count: number;
  helpful_count: number;
  created_at: string;
  updated_at: string;
  created_by?: string | null;
}

/**
 * Backend ì‘ë‹µì„ Frontend FAQ íƒ€ìž…ìœ¼ë¡œ ë³€í™˜
 */
export function convertFAQResponseToFAQ(response: FAQResponse): FAQ {
  // tagsë¥¼ ë°°ì—´ë¡œ ë³€í™˜ (ì‰¼í‘œë¡œ êµ¬ë¶„ëœ ë¬¸ìžì—´ì¸ ê²½ìš°)
  let tags: string[] = [];
  if (response.tags) {
    if (typeof response.tags === 'string') {
      // ì‰¼í‘œë¡œ êµ¬ë¶„ëœ ë¬¸ìžì—´ì„ ë°°ì—´ë¡œ ë³€í™˜
      tags = response.tags.split(',').map(tag => tag.trim()).filter(tag => tag.length > 0);
    } else if (Array.isArray(response.tags)) {
      tags = response.tags;
    }
  }

  return {
    faqId: response.faq_id,
    question: response.question,
    answer: response.answer,
    category: response.category || undefined,
    tags: tags.length > 0 ? tags : undefined,
    productId: response.product_id || undefined,
    productName: response.product_name || undefined,
    status: response.status === 'published' ? 'published' : 'draft',
    isAutoGenerated: response.is_auto_generated,
    source: response.source as 'pdf' | 'chatbot' | 'manual',
    viewCount: response.view_count,
    helpfulCount: response.helpful_count,
    createdAt: new Date(response.created_at),
    updatedAt: new Date(response.updated_at),
    createdBy: response.created_by || 'Unknown',
  };
}

/**
 * FAQ ë°°ì—´ ë³€í™˜
 */
export function convertFAQResponseArrayToFAQArray(responses: FAQResponse[]): FAQ[] {
  return responses.map(convertFAQResponseToFAQ);
}

